# Инструкция по использованию плагинов

## Расположение плагинов

Поместите ваши готовые `.so` файлы плагинов в следующую структуру:

```
myZemax/
└── plugins/
    ├── backend/          # Плагины графического бэкенда (обязательны!)
    │   └── sfml_backend.so
    └── tools/            # Плагины инструментов (опционально)
        └── drawing_tools.so
```

Или просто в корень папки `plugins/`:

```
myZemax/
└── plugins/
    ├── sfml_backend.so
    └── drawing_tools.so
```

## Типы плагинов

### 1. Плагин бэкенда (DR4BackendPlugin) - ОБЯЗАТЕЛЕН

Без плагина бэкенда приложение не запустится!

**Требования:**
- Должен реализовывать интерфейс `cum::DR4BackendPlugin`
- Должен экспортировать функцию `CreatePlugin()` с C-линковкой:
  ```cpp
  extern "C" cum::Plugin* CreatePlugin() {
      return new YourBackendPlugin();
  }
  ```
- Должен создавать окна через `CreateWindow()`

**Пример расположения:**
```
plugins/backend/sfml_backend.so
```

### 2. Плагин инструментов (PPToolPlugin) - опционально

**Требования:**
- Должен реализовывать интерфейс `cum::PPToolPlugin`
- Должен экспортировать функцию `CreatePlugin()`

**Пример расположения:**
```
plugins/tools/drawing_tools.so
```

## Загрузка плагинов

Плагины загружаются автоматически при запуске приложения в следующем порядке:

1. Сначала загружаются все плагины из `plugins/backend/`
2. Затем загружаются плагины из корня `plugins/`
3. Проверяются зависимости между плагинами
4. Вызывается `AfterLoad()` для всех плагинов

## Проверка загруженных плагинов

После запуска приложения:
1. Нажмите на кнопку **"Plugins"** в toolbar
2. В выпадающем меню вы увидите список всех загруженных плагинов с их названиями и идентификаторами

## Отладка

Если плагин не загружается, проверьте:

1. **Правильность пути:**
   - Плагин должен быть в папке `plugins/` или `plugins/backend/`
   - Путь указывается относительно рабочей директории приложения

2. **Расширение файла:**
   - На Linux: `.so`
   - На Windows: `.dll` (но стандарт использует `dlopen`, который работает на Linux)

3. **Экспорт функции:**
   - Убедитесь, что функция `CreatePlugin()` экспортирована с `extern "C"`

4. **Зависимости:**
   - Проверьте, что все зависимости плагина загружены
   - Ошибки зависимостей выводятся в консоль

5. **Консольный вывод:**
   - При запуске приложение выводит информацию о загрузке плагинов
   - Ошибки загрузки также выводятся в консоль

## Пример структуры для тестирования

```
myZemax/
├── build/
│   └── myZemax          # Скомпилированное приложение
├── plugins/
│   └── backend/
│       └── sfml_backend.so
└── ...
```

Запуск:
```bash
cd build
./myZemax
```

Приложение автоматически найдет и загрузит `plugins/backend/sfml_backend.so`.

## Примечания для Windows

Стандарт использует `dlopen()` (Linux API). На Windows может потребоваться:

1. Использовать WSL или Linux окружение
2. Или адаптировать код для использования `LoadLibrary()` (Windows API)

Для тестирования рекомендуется использовать Linux окружение.





